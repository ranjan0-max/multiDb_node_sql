datasource newdb {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator newDbClient {
  provider = "prisma-client-js"
  output   = "../../generated/newDb"
}

model Task {
  id             Int       @id @default(autoincrement())
  taskNumber     String?
  taskTitle      String
  raisedTo       Int
  departmentId   Int ?
  categoryId     Int ?
  closeDate      DateTime
  taskBody       String?
  status         String    @default("OPEN")
  createdBy      Int?
  createdAt      DateTime? @default(now())
  updatedAt      DateTime? @updatedAt

  Department    Department ? @relation(fields: [departmentId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  Category      Category ? @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  Attachment    Attachment[]
  ChatRoom      ChatRoom[]
}

model RecurrenceTask {
  id                 Int       @id @default(autoincrement())
  taskNumber         String?
  taskTitle          String
  raisedTo           Int
  departmentId       Int?
  categoryId         Int?
  closeDate          DateTime
  taskBody           String?
  status             String    @default("OPEN")
  createdBy          Int?
  frequency          String   
  isScheduleActive   Boolean  @default(true) 
  nextRunAt          DateTime?
  createdAt          DateTime? @default(now())
  updatedAt          DateTime? @updatedAt

  Department         Department? @relation(fields: [departmentId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  Category           Category? @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  Attachment         Attachment[]
}

model Department {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  Category Category[]
  Task Task[]
  RecurrenceTask  RecurrenceTask[]
}

model Category {
  id            Int       @id @default(autoincrement())
  name          String
  departmentId  Int
  createdAt     DateTime? @default(now())
  updatedAt     DateTime? @updatedAt

  Task          Task[]
  RecurrenceTask  RecurrenceTask[]
  Department    Department @relation(fields: [departmentId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model ChatRoom {
  id        Int       @id @default(autoincrement())
  roomId    String    @unique
  taskId    Int
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  Task      Task @relation(fields: [taskId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Chat {
  id        Int       @id @default(autoincrement())
  roomId    String
  userId    Int
  message   String
  type      String
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt

  @@index([roomId])
}

model Attachment {
  id                Int       @id @default(autoincrement())
  taskId            Int? 
  recurrenceTaskId  Int?   
  path              String
  createdAt         DateTime? @default(now())
  updatedAt         DateTime? @updatedAt

  Task              Task? @relation(fields: [taskId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  recurrenceTask    RecurrenceTask? @relation(fields: [recurrenceTaskId], references: [id])
}